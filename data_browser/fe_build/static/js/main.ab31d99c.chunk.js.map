{"version":3,"sources":["Util.js","Results.js","Query.js","Components.js","App.js","index.js"],"names":["assert","require","fetchInProgress","nextFetch","undefined","version","document","getElementById","textContent","trim","CopyText","props","text","ref","useRef","TLink","className","onClick","event","range","createRange","selectNodeContents","current","window","getSelection","removeAllRanges","addRange","execCommand","target","blur","children","type","SLink","AbortError","name","Error","doFetch","url","options","process","reject","Promise","resolve","fetch","then","response","next","res","err","ok","status","response_version","headers","get","console","log","location","reload","doGet","method","json","useData","useState","data","setData","useEffect","updates","prev","Cookies","body","JSON","stringify","doPatch","catch","e","Save","apiUrl","redirectUrl","saving","setSaving","doPost","to","Delete","state","setState","Overlay","message","Object","prototype","hasOwnProperty","Spacer","spaces","Array","map","_","key","HeadCell","query","field","modelField","getField","pathStr","getType","removeField","moveField","canPivot","togglePivot","pivoted","concrete","defaultLookup","addFilter","toggleSort","prettyPathStr","dsc","priority","asc","null","sort","DataCell","React","memo","formattedValue","span","value","formatHint","dangerouslySetInnerHTML","__html","highCutOff","lowCutOff","toExponential","significantFigures","toLocaleString","String","colSpan","VTableHeadRow","fields","classNameFirst","i","VTableBodyRow","row","formatHints","HTableRow","col","Results","cols","rows","overlay","colFields","rowFields","length","resFields","rowIndex","table","empty","filterErrors","getPartsForQuery","model","f","join","filters","lookup","limit","getRelUrlForQuery","media","query_str","getUrlForQuery","baseUrl","relUrl","origin","Query","config","setQuery","this","path","split","slice","allModelFields","types","lookup_type","lookups","endsWith","choices","defaultValue","findIndex","newFields","filter","priorities","newPriority","Math","max","push","left","index","_getFieldIndex","newIndex","splice","concat","newSort","newFilters","getDefaultLookupValue","Number","defaultFilters","defaultRowLimit","prettyPath","part","prettyName","FilterValue","onChange","lookupType","onChangeEvent","option","step","parts","Filter","errorMessage","removeFilter","addField","defaultSort","setFilterLookup","sortedLookups","lookupName","replace","val","setFilterValue","Filters","Field","toggled","setToggled","AllFields","modelFields","getModelFields","sortedFields","fieldName","ModelSelector","sortedModels","setModel","Logo","QueryPage","results","setLimit","min","href","getUrlForMedia","view","pk","EditSavedView","canMakePublic","useParams","setView","link","placeholder","createdTime","description","checked","public","publicLink","googleSheetsFormula","SavedViewList","savedViews","HomePage","QueryApp","fieldStr","setStatus","queryStr","useLocation","search","handleError","Sentry","fetchResults","popstate","reqState","history","replaceState","addEventListener","removeEventListener","queryObj","queryChange","newState","request","pushState","sortBy","req","deepStrictEqual","App","basename","id","parse","sentryDsn","dsn","release","attachStacktrace","maxValueLength","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.ab31d99c.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport Cookies from \"js-cookie\";\nimport \"./App.css\";\nconst assert = require(\"assert\");\nlet fetchInProgress = false;\nlet nextFetch = undefined;\n\nconst version = document.getElementById(\"backend-version\").textContent.trim();\n\nfunction CopyText(props) {\n    const { text } = props;\n    const ref = useRef(null);\n    return (\n        <>\n            <span ref={ref}>{text}</span>{\" \"}\n            <TLink\n                className=\"CopyToClipboard\"\n                onClick={(event) => {\n                    const range = document.createRange();\n                    range.selectNodeContents(ref.current);\n                    window.getSelection().removeAllRanges();\n                    window.getSelection().addRange(range);\n                    document.execCommand(\"copy\");\n                    window.getSelection().removeAllRanges();\n                    event.target.blur();\n                }}\n            >\n                (copy to clipboard)\n            </TLink>\n        </>\n    );\n}\n\nfunction TLink(props) {\n    const { className, onClick, children } = props;\n    return (\n        <button\n            {...{ onClick }}\n            type=\"button\"\n            className={\"Link \" + (className || \"\")}\n        >\n            {children}\n        </button>\n    );\n}\n\nfunction SLink(props) {\n    const { className, onClick, children } = props;\n    return (\n        <button\n            {...{ onClick }}\n            type=\"button\"\n            className={\"sLink material-icons \" + (className || \"\")}\n        >\n            {children}\n        </button>\n    );\n}\n\nclass AbortError extends Error {\n    name = \"AbortError\";\n}\n\nfunction doFetch(url, options, process) {\n    if (fetchInProgress) {\n        if (nextFetch) {\n            nextFetch.reject(new AbortError(\"skipped\"));\n        }\n        return new Promise((resolve, reject) => {\n            nextFetch = { resolve, reject, url, options, process };\n        });\n    }\n\n    fetchInProgress = true;\n\n    return fetch(url, options)\n        .then((response) => {\n            // do we have a next fetch we need to trigger\n            const next = nextFetch;\n            nextFetch = undefined;\n            fetchInProgress = false;\n\n            if (next) {\n                doFetch(next.url, next.options, next.process).then(\n                    (res) => next.resolve(res),\n                    (err) => next.reject(err)\n                );\n                throw new AbortError(\"superceeded\");\n            } else {\n                return response;\n            }\n        })\n        .then((response) => {\n            // check status\n            assert.ok(response.status >= 200);\n            assert.ok(response.status < 300);\n            return response;\n        })\n        .then((response) => {\n            // check server version\n            const response_version = response.headers.get(\"x-version\");\n            if (response_version !== version) {\n                console.log(\n                    \"Version mismatch, hard reload\",\n                    version,\n                    response_version\n                );\n                window.location.reload(true);\n            }\n            return response;\n        })\n        .then((response) => process(response)); // process data\n}\n\nfunction doGet(url) {\n    return doFetch(url, { method: \"GET\" }, (response) => response.json());\n}\n\nfunction doDelete(url) {\n    return doFetch(\n        url,\n        {\n            method: \"DELETE\",\n            headers: { \"X-CSRFToken\": Cookies.get(\"csrftoken\") },\n        },\n        (response) => response\n    );\n}\n\nfunction doPatch(url, data) {\n    return doFetch(\n        url,\n        {\n            method: \"PATCH\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-CSRFToken\": Cookies.get(\"csrftoken\"),\n            },\n            body: JSON.stringify(data),\n        },\n        (response) => response.json()\n    );\n}\n\nfunction doPost(url, data) {\n    return doFetch(\n        url,\n        {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-CSRFToken\": Cookies.get(\"csrftoken\"),\n            },\n            body: JSON.stringify(data),\n        },\n        (response) => response.json()\n    );\n}\n\nfunction useData(url) {\n    const [data, setData] = useState();\n    useEffect(() => {\n        doGet(url).then((response) => setData(response));\n    }, [url]);\n    return [\n        data,\n        (updates) => {\n            setData((prev) => ({ ...prev, ...updates }));\n            doPatch(url, updates)\n                .then((response) =>\n                    setData((prev) => ({ ...prev, ...response }))\n                )\n                .catch((e) => {\n                    if (e.name !== \"AbortError\") throw e;\n                });\n        },\n    ];\n}\n\nfunction Save(props) {\n    const { name, apiUrl, data, redirectUrl } = props;\n    const [saving, setSaving] = useState(\"save\");\n    if (saving === \"save\")\n        return (\n            <TLink\n                onClick={(event) => {\n                    setSaving(\"saving\");\n                    doPost(apiUrl, data).then((response) =>\n                        setSaving(response)\n                    );\n                }}\n            >\n                Save {name || \"\"}\n            </TLink>\n        );\n    else if (saving === \"saving\") return <>Saving {name || \"\"}</>;\n    else {\n        const url =\n            typeof redirectUrl === \"function\"\n                ? redirectUrl(saving)\n                : redirectUrl;\n        return <Redirect to={url} />;\n    }\n}\n\nfunction Delete(props) {\n    const { name, apiUrl, redirectUrl } = props;\n    const [state, setState] = useState(\"normal\");\n    if (state === \"normal\")\n        return (\n            <TLink\n                onClick={(event) => {\n                    setState(\"confirm\");\n                }}\n            >\n                Delete {name || \"\"}\n            </TLink>\n        );\n    else if (state === \"confirm\")\n        return (\n            <TLink\n                onClick={(event) => {\n                    setState(\"deleting\");\n                    doDelete(apiUrl).then((response) => setState(\"deleted\"));\n                }}\n            >\n                Are you sure?\n            </TLink>\n        );\n    else if (state === \"deleting\") return \"Deleting\";\n    else if (state === \"deleted\") return <Redirect to={redirectUrl} />;\n    else throw new Error(`unknown delete state: ${state}`);\n}\n\nfunction Overlay(props) {\n    if (!props.message) return null;\n    return (\n        <div className=\"Overlay\">\n            <h1>{props.message}</h1>\n        </div>\n    );\n}\n\nfunction is(x: any, y: any) {\n    return (\n        (x === y && (x !== 0 || 1 / x === 1 / y)) || (x !== x && y !== y) // eslint-disable-line no-self-compare\n    );\n}\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\nfunction shallowEqual(objA: mixed, objB: mixed): boolean {\n    if (is(objA, objB)) {\n        return true;\n    }\n\n    if (\n        typeof objA !== \"object\" ||\n        objA === null ||\n        typeof objB !== \"object\" ||\n        objB === null\n    ) {\n        return false;\n    }\n\n    const keysA = Object.keys(objA);\n    const keysB = Object.keys(objB);\n\n    if (keysA.length !== keysB.length) {\n        console.log(\"different keys\", keysA, keysB);\n        return false;\n    }\n\n    // Test for A's keys different from B.\n    for (let i = 0; i < keysA.length; i++) {\n        if (\n            !hasOwnProperty.call(objB, keysA[i]) ||\n            !is(objA[keysA[i]], objB[keysA[i]])\n        ) {\n            console.log(\n                \"different key\",\n                keysA[i],\n                objA[keysA[i]],\n                objB[keysA[i]]\n            );\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport {\n    TLink,\n    SLink,\n    doPatch,\n    doGet,\n    doDelete,\n    doPost,\n    useData,\n    version,\n    Save,\n    Delete,\n    CopyText,\n    fetchInProgress,\n    Overlay,\n    shallowEqual,\n};\n","import React from \"react\";\nimport \"./App.css\";\nimport { TLink, SLink, Overlay } from \"./Util\";\n\nfunction Spacer(props) {\n  const { spaces } = props;\n  if (spaces > 0) {\n    return [...Array(spaces)].map((_, key) => (\n      <td className=\"Empty\" key={key} />\n    ));\n  }\n  return null;\n}\n\nfunction HeadCell(props) {\n  const { query, field, className } = props;\n  const modelField = query.getField(field.pathStr);\n  const type = query.getType(modelField);\n  return (\n    <th {...{ className }}>\n      <SLink onClick={() => query.removeField(field)}>close</SLink>\n      <SLink onClick={() => query.moveField(field, true)}>chevron_left</SLink>\n      <SLink onClick={() => query.moveField(field, false)}>chevron_right</SLink>\n      {modelField.canPivot && (\n        <>\n          <SLink onClick={() => query.togglePivot(field)}>\n            {field.pivoted ? \"call_received\" : \"call_made\"}\n          </SLink>\n        </>\n      )}\n      {modelField.concrete && type.defaultLookup ? (\n        <>\n          <SLink onClick={() => query.addFilter(field.pathStr)}>\n            filter_alt\n          </SLink>{\" \"}\n          <TLink onClick={() => query.toggleSort(field)}>\n            {query.prettyPathStr(field.pathStr)}\n            {\n              {\n                dsc: `↑${field.priority}`,\n                asc: `↓${field.priority}`,\n                null: \"\",\n              }[field.sort]\n            }\n          </TLink>\n        </>\n      ) : (\n        \" \" + query.prettyPathStr(field.pathStr)\n      )}\n    </th>\n  );\n}\n\nconst DataCell = React.memo((props) => {\n  const { modelField, className, span, value, formatHint } = props;\n  let formattedValue;\n  if (value === undefined) {\n    formattedValue = \"\";\n  } else if (value === null) {\n    formattedValue = null;\n  } else if (modelField.type === \"html\" && value) {\n    formattedValue = <div dangerouslySetInnerHTML={{ __html: value }} />;\n  } else if (modelField.type === \"number\") {\n    if (\n      value > formatHint.highCutOff ||\n      value < -formatHint.highCutOff ||\n      (value && value < formatHint.lowCutOff && value > -formatHint.lowCutOff)\n    ) {\n      formattedValue = value.toExponential(formatHint.significantFigures - 1);\n    } else {\n      formattedValue = value.toLocaleString(undefined, formatHint);\n    }\n  } else {\n    formattedValue = String(value);\n  }\n  return (\n    <td className={modelField.type + \" \" + className || \"\"} colSpan={span || 1}>\n      {formattedValue}\n    </td>\n  );\n});\n\nfunction VTableHeadRow(props) {\n  const { fields, query, classNameFirst, className } = props;\n  return fields.map((field, i) => (\n    <HeadCell\n      {...{ query, field }}\n      key={field.pathStr}\n      className={`HoriBorder ${className} ` + (i ? \"\" : classNameFirst)}\n    />\n  ));\n}\n\nfunction VTableBodyRow(props) {\n  const { fields, query, classNameFirst, className, row, formatHints } = props;\n  return fields.map((field, i) => {\n    if (row)\n      return (\n        <DataCell\n          key={field.pathStr}\n          value={row[field.pathStr]}\n          className={`${i ? \"\" : classNameFirst} ${className}`}\n          modelField={query.getField(field.pathStr)}\n          formatHint={formatHints[field.pathStr]}\n        />\n      );\n    else\n      return (\n        <td\n          key={field.pathStr}\n          className={`${i ? \"\" : classNameFirst} Empty`}\n        ></td>\n      );\n  });\n}\n\nfunction HTableRow(props) {\n  const { query, field, data, span, className, formatHints } = props;\n  return (\n    <>\n      <HeadCell {...{ query, field }} />\n      {data.map((col, key) => (\n        <DataCell\n          {...{ key, span, className }}\n          value={col[field.pathStr]}\n          modelField={query.getField(field.pathStr)}\n          formatHint={formatHints[field.pathStr]}\n        />\n      ))}\n    </>\n  );\n}\n\nfunction Results(props) {\n  const { query, cols, rows, body, overlay, formatHints } = props;\n  return (\n    <div className=\"Results\">\n      <Overlay message={overlay} />\n      <div className=\"Scroller\">\n        <table>\n          <thead>\n            {/* pivoted data */}\n            {query.colFields().map((field) => {\n              return (\n                <tr key={field.pathStr}>\n                  <Spacer spaces={query.rowFields().length - 1} />\n                  <HTableRow\n                    {...{ query, field, formatHints }}\n                    span={query.resFields().length}\n                    data={cols}\n                    className={overlay && \"Fade\"}\n                  />\n                </tr>\n              );\n            })}\n\n            {/* column headers */}\n            <tr>\n              <Spacer spaces={1 - query.rowFields().length} />\n              <VTableHeadRow\n                {...{ query }}\n                fields={query.rowFields()}\n                className=\"Freeze\"\n              />\n              {cols.map((_, key) => (\n                <VTableHeadRow\n                  {...{ key, query }}\n                  fields={query.resFields()}\n                  classNameFirst=\"LeftBorder\"\n                  className=\"Freeze\"\n                />\n              ))}\n            </tr>\n          </thead>\n\n          {/* row headers and body */}\n          <tbody className={overlay && \"Fade\"}>\n            {rows.map((row, rowIndex) => (\n              <tr key={rowIndex}>\n                <Spacer spaces={1 - query.rowFields().length} />\n                <VTableBodyRow\n                  {...{ query, row, formatHints }}\n                  fields={query.rowFields()}\n                />\n                {body.map((table, key) => (\n                  <VTableBodyRow\n                    {...{ key, query, formatHints }}\n                    fields={query.resFields()}\n                    row={table[rowIndex]}\n                    classNameFirst=\"LeftBorder\"\n                  />\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n\nexport { Results };\n","const empty = {\n  rows: [{}],\n  cols: [{}],\n  body: [[{}]],\n  length: 0,\n  filterErrors: [],\n  formatHints: {},\n};\n\nfunction getPartsForQuery(query) {\n  return {\n    model: query.model,\n    fields: query.fields\n      .map(\n        (f) =>\n          (f.pivoted ? \"&\" : \"\") +\n          f.pathStr +\n          { asc: `+${f.priority}`, dsc: `-${f.priority}`, null: \"\" }[f.sort]\n      )\n      .join(\",\"),\n    query: query.filters\n      .map((f) => `${f.pathStr}__${f.lookup}=${f.value}`)\n      .join(\"&\"),\n    limit: query.limit,\n  };\n}\n\nfunction getRelUrlForQuery(query, media) {\n  const { model, fields, query: query_str, limit } = getPartsForQuery(query);\n  return `query/${model}/${fields}.${media}?${query_str}&limit=${limit}`;\n}\n\nfunction getUrlForQuery(baseUrl, query, media) {\n  const relUrl = getRelUrlForQuery(query, media);\n  return `${window.location.origin}${baseUrl}${relUrl}`;\n}\n\nclass Query {\n  constructor(config, query, setQuery) {\n    this.config = config;\n    this.query = query;\n    this.setQuery = setQuery;\n  }\n\n  getField(pathStr) {\n    const path = pathStr.split(\"__\");\n    let model = this.query.model;\n    for (const field of path.slice(0, -1)) {\n      model = this.config.allModelFields[model].fields[field].model;\n    }\n    return this.config.allModelFields[model].fields[path.slice(-1)];\n  }\n\n  getType(field) {\n    return this.config.types[field.type];\n  }\n\n  getModelFields(model) {\n    return this.config.allModelFields[model];\n  }\n\n  getDefaultLookupValue(field, type, lookup) {\n    const lookup_type = type.lookups[lookup].type;\n    if (lookup_type.endsWith(\"choice\")) return String(field.choices[0]);\n    else return String(this.config.types[lookup_type].defaultValue);\n  }\n\n  _getFieldIndex(field, fields) {\n    return fields.findIndex((f) => f.pathStr === field.pathStr);\n  }\n\n  addField(pathStr, sort) {\n    const newFields = this.query.fields.filter((f) => f.pathStr !== pathStr);\n    const priorities = newFields\n      .map((f) => f.priority)\n      .filter((f) => f !== null);\n    const newPriority = priorities.length ? Math.max(...priorities) + 1 : 0;\n    newFields.push({\n      pathStr: pathStr,\n      sort: sort,\n      priority: sort ? newPriority : null,\n      pivoted: false,\n    });\n    this.setQuery({ fields: newFields });\n  }\n\n  removeField(field) {\n    const modelField = this.getField(field.pathStr);\n    this.setQuery(\n      {\n        fields: this.query.fields.filter((f) => f.pathStr !== field.pathStr),\n      },\n      modelField.canPivot\n    );\n  }\n\n  moveField(field, left) {\n    const modelField = this.getField(field.pathStr);\n\n    // get the fields in their sections\n    const colFields = this.colFields().slice();\n    const rowFields = this.rowFields().slice();\n    const resFields = this.resFields().slice();\n\n    // pick the section our field is in\n    let fields = null;\n    if (field.pivoted) fields = colFields;\n    else if (modelField.canPivot || !colFields.length) fields = rowFields;\n    else fields = resFields;\n\n    // work out it's old and new index\n    const index = this._getFieldIndex(field, fields);\n    const newIndex = index + (left ? -1 : 1);\n\n    // if anything changed then update our section and then\n    // rebuild all the fields from the sections\n    if (0 <= newIndex && newIndex < fields.length) {\n      fields.splice(index, 1);\n      fields.splice(newIndex, 0, field);\n      this.setQuery(\n        { fields: [].concat(rowFields, colFields, resFields) },\n        false\n      );\n    }\n  }\n\n  toggleSort(field) {\n    const index = this._getFieldIndex(field, this.query.fields);\n    const newSort = { asc: \"dsc\", dsc: null, null: \"asc\" }[field.sort];\n    let newFields = this.query.fields.slice();\n\n    if (field.sort) {\n      // move any later sort fields forward\n      newFields = newFields.map((f) => ({\n        ...f,\n        priority:\n          f.priority != null && f.priority > field.priority\n            ? f.priority - 1\n            : f.priority,\n      }));\n    }\n\n    if (newSort) {\n      // move all other fiels back and insert the updated one\n      newFields = newFields.map((f) => ({\n        ...f,\n        priority: f.priority != null ? f.priority + 1 : f.priority,\n      }));\n      newFields[index] = { ...field, sort: newSort, priority: 0 };\n    } else {\n      // blank the sort on the updated field\n      newFields[index] = { ...field, sort: null, priority: null };\n    }\n\n    this.setQuery({\n      fields: newFields,\n    });\n  }\n\n  togglePivot(field) {\n    const index = this._getFieldIndex(field, this.query.fields);\n    let newFields = this.query.fields.slice();\n    newFields[index].pivoted = !newFields[index].pivoted;\n    this.setQuery({\n      fields: newFields,\n    });\n  }\n\n  addFilter(pathStr) {\n    const field = this.getField(pathStr);\n    const type = this.getType(field);\n    const newFilters = this.query.filters.slice();\n    newFilters.push({\n      pathStr: pathStr,\n      lookup: type.defaultLookup,\n      value: this.getDefaultLookupValue(field, type, type.defaultLookup),\n    });\n    this.setQuery({ filters: newFilters });\n  }\n\n  removeFilter(index) {\n    const newFilters = this.query.filters.slice();\n    newFilters.splice(index, 1);\n    this.setQuery({ filters: newFilters });\n  }\n\n  setFilterValue(index, value) {\n    const newFilters = this.query.filters.slice();\n    newFilters[index] = { ...newFilters[index], value: value };\n    this.setQuery({ filters: newFilters });\n  }\n\n  setFilterLookup(index, lookup) {\n    const newFilters = this.query.filters.slice();\n    const filter = newFilters[index];\n    const field = this.getField(newFilters[index].pathStr);\n    const type = this.getType(field);\n    if (type.lookups[filter.lookup].type !== type.lookups[lookup].type) {\n      filter.value = this.getDefaultLookupValue(field, type, lookup);\n    }\n    filter.lookup = lookup;\n    this.setQuery({ filters: newFilters });\n  }\n\n  setLimit(limit) {\n    limit = Number(limit);\n    this.setQuery({ limit: limit > 0 ? limit : 1 });\n  }\n\n  setModel(model) {\n    this.setQuery({\n      model: model,\n      fields: [],\n      filters: this.config.allModelFields[model].defaultFilters,\n      limit: this.config.defaultRowLimit,\n      ...empty,\n    });\n  }\n\n  getUrlForMedia(media) {\n    return getUrlForQuery(this.config.baseUrl, this.query, media);\n  }\n\n  colFields() {\n    return this.query.fields.filter((f) => f.pivoted);\n  }\n\n  rowFields() {\n    if (this.colFields().length) {\n      return this.query.fields.filter(\n        (f) => !f.pivoted && this.getField(f.pathStr).canPivot\n      );\n    } else {\n      return this.query.fields;\n    }\n  }\n\n  resFields() {\n    if (this.colFields().length) {\n      return this.query.fields.filter(\n        (f) => !this.getField(f.pathStr).canPivot\n      );\n    } else {\n      return [];\n    }\n  }\n\n  prettyPathStr(pathStr) {\n    const path = pathStr.split(\"__\");\n    const prettyPath = [];\n    let model = this.query.model;\n    let field = null;\n    for (const part of path) {\n      field = this.config.allModelFields[model].fields[part];\n      model = field.model;\n      prettyPath.push(field.prettyName);\n    }\n    return prettyPath.join(\" \\u21d2 \");\n  }\n}\n\nexport { Query, getPartsForQuery, getRelUrlForQuery, getUrlForQuery, empty };\n","import React, { useState } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { TLink, SLink, useData, version, Save, Delete, CopyText } from \"./Util\";\nimport { Results } from \"./Results\";\nimport { getPartsForQuery, getRelUrlForQuery } from \"./Query\";\nimport \"./App.css\";\n\nfunction FilterValue(props) {\n  const { lookup, lookupType, onChange, value, field } = props;\n  const onChangeEvent = (e) => onChange(e.target.value);\n  if (props.lookup.type === \"boolean\")\n    return (\n      <select {...{ value }} onChange={onChangeEvent} className=\"FilterValue\">\n        <option value={true}>true</option>\n        <option value={false}>false</option>\n      </select>\n    );\n  else if (props.lookup.type === \"isnull\")\n    return (\n      <select {...{ value }} onChange={onChangeEvent} className=\"FilterValue\">\n        <option value={\"IsNull\"}>IsNull</option>\n        <option value={\"NotNull\"}>NotNull</option>\n        <option value={\"MissingField\"}>MissingField</option>\n      </select>\n    );\n  else if (lookup.type.endsWith(\"choice\"))\n    return (\n      <select {...{ value }} onChange={onChangeEvent} className=\"FilterValue\">\n        {field.choices.map((option) => (\n          <option value={option}>{option}</option>\n        ))}\n      </select>\n    );\n  else if (lookup.type === \"number\")\n    return (\n      <input\n        {...{ value }}\n        onChange={onChangeEvent}\n        className=\"FilterValue\"\n        type=\"number\"\n        step=\"0\"\n      />\n    );\n  else if (lookup.type === \"jsonfield\") {\n    const parts = value.split(/\\|(.*)/);\n    return (\n      <>\n        <input\n          value={parts[0]}\n          onChange={(e) => onChange(`${e.target.value}|${parts[1]}`)}\n          className=\"FilterValue Half\"\n          type=\"text\"\n        />\n        <input\n          value={parts[1]}\n          onChange={(e) => onChange(`${parts[0]}|${e.target.value}`)}\n          className=\"FilterValue Half\"\n          type=\"text\"\n        />\n      </>\n    );\n  } else\n    return (\n      <input\n        {...{ value }}\n        onChange={onChangeEvent}\n        className=\"FilterValue\"\n        type=\"text\"\n      />\n    );\n}\n\nfunction Filter(props) {\n  const { pathStr, index, lookup, query, value, errorMessage } = props;\n  const field = query.getField(pathStr);\n  const type = query.getType(field);\n  return (\n    <tr>\n      <td>\n        <SLink onClick={() => query.removeFilter(index)}>close</SLink>{\" \"}\n        <TLink onClick={() => query.addField(pathStr, field.defaultSort)}>\n          {query.prettyPathStr(pathStr)}\n        </TLink>{\" \"}\n      </td>\n      <td>\n        <select\n          className=\"Lookup\"\n          value={lookup}\n          onChange={(e) => query.setFilterLookup(index, e.target.value)}\n        >\n          {type.sortedLookups.map((lookupName) => (\n            <option key={lookupName} value={lookupName}>\n              {lookupName.replace(/_/g, \" \")}\n            </option>\n          ))}\n        </select>\n      </td>\n      <td>=</td>\n      <td>\n        <FilterValue\n          {...{ value, field }}\n          onChange={(val) => query.setFilterValue(index, val)}\n          lookup={type.lookups[lookup]}\n          lookupType={query.getType(type.lookups[lookup])}\n        />\n        {errorMessage && <p className=\"Error\">{errorMessage}</p>}\n      </td>\n    </tr>\n  );\n}\n\nfunction Filters(props) {\n  const { query, filterErrors } = props;\n  return (\n    <form className=\"Filters\">\n      <table className=\"Flat\">\n        <tbody>\n          {props.filters.map((filter, index) => (\n            <Filter\n              {...{ query, index }}\n              {...filter}\n              key={index}\n              errorMessage={filterErrors[index]}\n            />\n          ))}\n        </tbody>\n      </table>\n    </form>\n  );\n}\n\nfunction Field(props) {\n  const { query, path, modelField } = props;\n  const type = query.getType(modelField);\n  const [toggled, setToggled] = useState(false);\n  return (\n    <>\n      <tr>\n        <td>\n          {modelField.concrete && type.defaultLookup && (\n            <SLink onClick={() => query.addFilter(path.join(\"__\"))}>\n              filter_alt\n            </SLink>\n          )}\n        </td>\n        <td>\n          {modelField.model && (\n            <SLink\n              className=\"ToggleLink\"\n              onClick={() => setToggled((toggled) => !toggled)}\n            >\n              {toggled ? \"remove\" : \"add\"}\n            </SLink>\n          )}\n        </td>\n        <td>\n          {modelField.type ? (\n            <TLink\n              onClick={() =>\n                query.addField(path.join(\"__\"), modelField.defaultSort)\n              }\n            >\n              {modelField.prettyName}\n            </TLink>\n          ) : (\n            modelField.prettyName\n          )}\n        </td>\n      </tr>\n      {toggled && (\n        <tr>\n          <td></td>\n          <td colSpan=\"2\">\n            <AllFields {...{ query, path }} model={modelField.model} />\n          </td>\n        </tr>\n      )}\n    </>\n  );\n}\n\nfunction AllFields(props) {\n  const { query, model, path } = props;\n  const modelFields = query.getModelFields(model);\n  return (\n    <table>\n      <tbody>\n        {modelFields.sortedFields.map((fieldName) => {\n          const modelField = modelFields.fields[fieldName];\n          return (\n            <Field\n              key={fieldName}\n              {...{ query, modelField }}\n              path={path.concat([fieldName])}\n            />\n          );\n        })}\n      </tbody>\n    </table>\n  );\n}\n\nfunction ModelSelector(props) {\n  const { query, sortedModels, model } = props;\n  return (\n    <select\n      className=\"ModelSelector\"\n      onChange={(e) => query.setModel(e.target.value)}\n      value={model}\n    >\n      {sortedModels.map((model) => (\n        <option key={model}>{model}</option>\n      ))}\n    </select>\n  );\n}\n\nfunction Logo(props) {\n  return (\n    <Link to=\"/\" className=\"Logo\">\n      <span>DDB</span>\n      <span className=\"Version\">v{version}</span>\n    </Link>\n  );\n}\n\nfunction QueryPage(props) {\n  const {\n    query,\n    rows,\n    cols,\n    body,\n    length,\n    sortedModels,\n    model,\n    filters,\n    filterErrors,\n    baseUrl,\n    overlay,\n    formatHints,\n  } = props;\n\n  let results;\n  if (query.rowFields().length || query.colFields().length)\n    results = (\n      <Results {...{ query, rows, cols, body, overlay, formatHints }} />\n    );\n  else results = <h2>No fields selected</h2>;\n\n  return (\n    <>\n      <ModelSelector {...{ query, sortedModels, model }} />\n      <Filters {...{ query, filters, filterErrors }} />\n      <p>\n        <span className={length >= query.query.limit ? \"Error\" : \"\"}>\n          Limit:{\" \"}\n          <input\n            className=\"RowLimit\"\n            type=\"number\"\n            value={query.query.limit}\n            onChange={(event) => {\n              query.setLimit(event.target.value);\n            }}\n            min=\"1\"\n          />{\" \"}\n          - Showing {length} results -{\" \"}\n        </span>\n        <a href={query.getUrlForMedia(\"csv\")}>Download as CSV</a> -{\" \"}\n        <a href={query.getUrlForMedia(\"json\")}>View as JSON</a> -{\" \"}\n        <Save\n          name=\"View\"\n          apiUrl={`${baseUrl}api/views/`}\n          data={getPartsForQuery(query.query)}\n          redirectUrl={(view) => `/views/${view.pk}.html`}\n        />\n      </p>\n      <div className=\"MainSpace\">\n        <div className=\"FieldsList\">\n          <AllFields {...{ query, model }} path={[]} />\n        </div>\n        {results}\n        <div />\n      </div>\n    </>\n  );\n}\n\nfunction EditSavedView(props) {\n  const { canMakePublic, baseUrl } = props;\n  const { pk } = useParams();\n  const url = `${baseUrl}api/views/${pk}/`;\n  const [view, setView] = useData(url);\n  if (!view) return \"\";\n  return (\n    <div className=\"EditSavedView\">\n      <div className=\"SavedViewActions\">\n        <span className=\"SavedViewTitle\">Saved View</span>\n        <Link to={view.link}>Open</Link>\n      </div>\n      <form>\n        <input\n          type=\"text\"\n          value={view.name}\n          onChange={(event) => {\n            setView({ name: event.target.value });\n          }}\n          className=\"SavedViewName\"\n          placeholder=\"enter a name\"\n        />\n        <table>\n          <tbody>\n            <tr>\n              <th>Model:</th>\n              <td>{view.model}</td>\n            </tr>\n            <tr>\n              <th>Fields:</th>\n              <td>{view.fields.replace(/,/g, \"\\u200b,\")}</td>\n            </tr>\n            <tr>\n              <th>Filters:</th>\n              <td>{view.query.replace(/&/g, \"\\u200b&\")}</td>\n            </tr>\n            <tr>\n              <th>Limit:</th>\n              <td className=\"SavedViewLimit\">\n                <input\n                  className=\"RowLimit\"\n                  type=\"number\"\n                  value={view.limit}\n                  onChange={(event) => {\n                    setView({ limit: event.target.value });\n                  }}\n                />\n              </td>\n            </tr>\n            <tr>\n              <th>Created Time:</th>\n              <td>{view.createdTime}</td>\n            </tr>\n          </tbody>\n        </table>\n        <textarea\n          value={view.description}\n          onChange={(event) => {\n            setView({ description: event.target.value });\n          }}\n          placeholder=\"enter a description\"\n        />\n        {canMakePublic && (\n          <table>\n            <tbody>\n              <tr>\n                <th>Is Public:</th>\n                <td>\n                  <input\n                    type=\"checkbox\"\n                    checked={view.public}\n                    onChange={(event) => {\n                      setView({ public: event.target.checked });\n                    }}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <th>Public link:</th>\n                <td>{view.public && <CopyText text={view.publicLink} />}</td>\n              </tr>\n              <tr>\n                <th>Google Sheets:</th>\n                <td>\n                  {view.public && <CopyText text={view.googleSheetsFormula} />}\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        )}\n      </form>\n      <div className=\"SavedViewActions\">\n        <Delete apiUrl={url} redirectUrl=\"/\" />\n        <Link to=\"/\">Done</Link>\n      </div>\n    </div>\n  );\n}\n\nfunction SavedViewList(props) {\n  const { baseUrl } = props;\n  const [savedViews] = useData(`${baseUrl}api/views/`);\n  if (!savedViews) return \"\";\n  return (\n    <div>\n      <h1>Saved Views</h1>\n      <div>\n        {savedViews.map((view, index) => (\n          <div key={index}>\n            <p>\n              <Link className=\"Link\" to={view.link}>\n                {view.name} - {view.model}\n              </Link>{\" \"}\n              (<Link to={`/views/${view.pk}.html`}>edit</Link>)\n            </p>\n            <p>{view.description}</p>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction HomePage(props) {\n  const { sortedModels, baseUrl, defaultRowLimit, allModelFields } = props;\n  return (\n    <div className=\"Index\">\n      <div>\n        <h1>Models</h1>\n        <div>\n          {sortedModels.map((model) => (\n            <div key={model}>\n              <Link\n                to={getRelUrlForQuery(\n                  {\n                    model: model,\n                    fields: [],\n                    filters: allModelFields[model].defaultFilters,\n                    limit: defaultRowLimit,\n                  },\n                  \"html\"\n                )}\n                className=\"Link\"\n              >\n                {model}\n              </Link>\n            </div>\n          ))}\n        </div>\n      </div>\n      <SavedViewList {...{ baseUrl }} />\n    </div>\n  );\n}\n\nexport { HomePage, QueryPage, Logo, EditSavedView };\n","import * as Sentry from \"@sentry/browser\";\nimport React, { useState, useEffect } from \"react\";\nimport { sortBy } from \"lodash\";\nimport {\n  BrowserRouter,\n  Switch,\n  Route,\n  useParams,\n  useLocation,\n} from \"react-router-dom\";\nimport \"./App.css\";\nimport { HomePage, QueryPage, Logo, EditSavedView } from \"./Components\";\nimport { Query, getUrlForQuery, empty } from \"./Query\";\nimport { doGet, fetchInProgress } from \"./Util\";\n\nconst assert = require(\"assert\");\n\nconst BOOTING = \"Booting...\";\nconst LOADING = \"Loading...\";\nconst ERROR = \"Error\";\n\nfunction QueryApp(props) {\n  const { config } = props;\n  const { model, fieldStr } = useParams();\n  const [status, setStatus] = useState(BOOTING);\n  const [query, setQuery] = useState({\n    model: \"\",\n    fields: [],\n    filters: [],\n    limit: config.defaultRowLimit,\n    ...empty,\n  });\n  const queryStr = useLocation().search;\n\n  const handleError = (e) => {\n    if (e.name !== \"AbortError\") {\n      setStatus(ERROR);\n      console.log(e);\n      Sentry.captureException(e);\n    }\n  };\n\n  const fetchResults = (state) => {\n    setStatus(LOADING);\n    const url = getUrlForQuery(config.baseUrl, state, \"json\");\n\n    return doGet(url).then((response) => {\n      setQuery((query) => ({\n        ...query,\n        body: response.body,\n        cols: response.cols,\n        rows: response.rows,\n        length: response.length,\n        formatHints: response.formatHints,\n        filterErrors: response.filterErrors,\n      }));\n      setStatus(fetchInProgress ? LOADING : undefined);\n      return response;\n    });\n  };\n\n  useEffect(() => {\n    const popstate = (e) => {\n      setQuery(e.state);\n      fetchResults(e.state).catch(handleError);\n    };\n\n    const url = `${config.baseUrl}query/${model}/${\n      fieldStr || \"\"\n    }.query${queryStr}`;\n\n    doGet(url).then((response) => {\n      const reqState = {\n        model: response.model,\n        fields: response.fields,\n        filters: response.filters,\n        limit: response.limit,\n        ...empty,\n      };\n      setQuery(reqState);\n      setStatus(LOADING);\n      window.history.replaceState(\n        reqState,\n        null,\n        getUrlForQuery(config.baseUrl, reqState, \"html\")\n      );\n      window.addEventListener(\"popstate\", popstate);\n      fetchResults(reqState).catch(handleError);\n    });\n\n    return () => {\n      window.removeEventListener(\"popstate\", popstate);\n    };\n    // eslint-disable-next-line\n  }, []);\n\n  const handleQueryChange = (queryChange, reload = true) => {\n    const newState = { ...query, ...queryChange };\n\n    setQuery(newState);\n\n    const request = {\n      model: newState.model,\n      fields: newState.fields,\n      filters: newState.filters,\n      limit: newState.limit,\n      ...empty,\n    };\n    window.history.pushState(\n      request,\n      null,\n      getUrlForQuery(config.baseUrl, newState, \"html\")\n    );\n\n    if (!reload) return;\n\n    fetchResults(newState)\n      .then((response) => {\n        const res = { ...response, ...empty };\n        res.filters = sortBy(res.filters, [\"pathStr\"]);\n        const req = { ...request };\n        req.filters = sortBy(req.filters, [\"pathStr\"]);\n        assert.deepStrictEqual(res, req);\n      })\n      .catch(handleError);\n  };\n\n  if (status === BOOTING) return \"\";\n  const queryObj = new Query(config, query, handleQueryChange);\n  return (\n    <QueryPage\n      overlay={status}\n      query={queryObj}\n      sortedModels={config.sortedModels}\n      baseUrl={config.baseUrl}\n      {...query}\n    />\n  );\n}\n\nfunction App(props) {\n  const { baseUrl, canMakePublic } = props;\n  return (\n    <BrowserRouter basename={baseUrl}>\n      <Logo />\n      <div id=\"body\">\n        <Switch>\n          <Route path=\"/query/:model/:fieldStr?.html\">\n            <QueryApp config={props} />\n          </Route>\n          <Route path=\"/views/:pk.html\">\n            <EditSavedView {...{ baseUrl, canMakePublic }} />\n          </Route>\n          <Route path=\"/\">\n            <HomePage {...props} />\n          </Route>\n        </Switch>\n      </div>\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport * as Sentry from \"@sentry/browser\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nconst config = JSON.parse(\n    document.getElementById(\"backend-config\").textContent\n);\nconst version = document.getElementById(\"backend-version\").textContent.trim();\n\nif (config.sentryDsn) {\n    Sentry.init({\n        dsn: config.sentryDsn,\n        release: version,\n        attachStacktrace: true,\n        maxValueLength: 10000,\n    });\n}\n\nReactDOM.render(\n    <React.StrictMode>\n        <App {...config} />\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n);\n"],"sourceRoot":""}